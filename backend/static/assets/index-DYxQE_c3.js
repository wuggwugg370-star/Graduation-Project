(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const a of c)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(c){const a={};return c.integrity&&(a.integrity=c.integrity),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?a.credentials="include":c.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(c){if(c.ep)return;c.ep=!0;const a=n(c);fetch(c.href,a)}})();const E="/api";async function r(e,t={}){const o=await(await fetch(`${E}${e}`,t)).json();if(o.code!==200)throw new Error(o.msg||"Error");return o.data||o}const b=()=>r("/menu"),I=e=>r("/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})}),v=e=>r("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})}),B=e=>r("/admin/item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i={menu:{},cart:{},activeCategory:"All",isAdmin:!1};async function h(){await u(),A(),sessionStorage.getItem("isAdmin")==="true"&&g()}async function u(){const e=document.getElementById("loading");try{i.menu=await b(),y(),l()}catch{e&&(e.innerText="Service Unavailable")}finally{e&&(e.style.display="none")}}function y(){const e=new Set(["All"]);Object.values(i.menu).forEach(n=>e.add(n.category||"其他"));const t=document.getElementById("category-bar");t&&(t.innerHTML="",e.forEach(n=>{const o=document.createElement("button");o.className=`cat-btn ${n===i.activeCategory?"active":""}`,o.innerText=n,o.onclick=()=>{i.activeCategory=n,y(),m()},t.appendChild(o)}))}function l(){const e=document.getElementById("menu-grid");e&&(e.innerHTML="",Object.entries(i.menu).forEach(([t,n])=>{const o=document.createElement("div");o.className="card",o.dataset.category=n.category||"其他",o.dataset.name=t;const c=i.isAdmin?'<button class="edit-btn" style="position:absolute;top:10px;right:10px;z-index:10;background:white;border:none;border-radius:10px;padding:5px;cursor:pointer;">✏️ Edit</button>':"";o.innerHTML=`
      <div class="card-img" style="background-image: url('${n.image||""}'); position:relative;">${c}</div>
      <div class="card-content">
        <div class="card-tag">${n.category}</div>
        <div class="card-title">${t}</div>
        <div class="card-price">¥${n.price}</div>
        <button class="btn add-btn">Add</button>
      </div>
    `,o.querySelector(".add-btn").onclick=()=>L(t),i.isAdmin&&(o.querySelector(".edit-btn").onclick=a=>{a.stopPropagation(),p(t,n)}),e.appendChild(o)}),m())}function m(){const e=document.getElementById("menu-grid"),t=document.getElementById("global-search").value.toLowerCase();Array.from(e.children).forEach(n=>{const o=n.dataset.name.toLowerCase(),c=n.dataset.category,a=i.activeCategory==="All"||c===i.activeCategory,d=o.includes(t);n.style.display=a&&d?"flex":"none"})}function g(){i.isAdmin=!0,document.getElementById("admin-toolbar").style.display="flex",document.getElementById("admin-login-btn").style.display="none",sessionStorage.setItem("isAdmin","true"),l()}function w(){i.isAdmin=!1,document.getElementById("admin-toolbar").style.display="none",document.getElementById("admin-login-btn").style.display="block",sessionStorage.removeItem("isAdmin"),l()}const s=document.getElementById("item-modal");function p(e="",t={}){s.style.display="flex",document.getElementById("input-name").value=e,document.getElementById("input-name").disabled=!!e,document.getElementById("input-price").value=t.price||"",document.getElementById("input-category").value=t.category||"",document.getElementById("input-image").value=t.image||"",document.getElementById("modal-title").innerText=e?"Edit Item":"Add New Item"}function A(){document.getElementById("search-trigger").onclick=()=>document.getElementById("search-overlay").classList.add("active"),document.getElementById("close-search").onclick=()=>document.getElementById("search-overlay").classList.remove("active"),document.getElementById("global-search").oninput=m;const e=t=>{const n=document.getElementById("cart-drawer").classList,o=document.getElementById("drawer-backdrop").classList;t?(n.add("open"),o.add("open")):(n.remove("open"),o.remove("open"))};document.getElementById("cart-toggle-btn").onclick=()=>e(!0),document.getElementById("close-drawer").onclick=()=>e(!1),document.getElementById("drawer-backdrop").onclick=()=>e(!1),document.getElementById("checkout-btn").onclick=async()=>{const t=Object.entries(i.cart).flatMap(([n,o])=>Array(o).fill(n));await I(t),i.cart={},f(),e(!1),document.getElementById("success-modal").classList.add("show")},document.getElementById("success-close-btn").onclick=()=>document.getElementById("success-modal").classList.remove("show"),document.getElementById("admin-login-btn").onclick=async()=>{const t=prompt("Enter Password:");if(t)try{await v(t),g()}catch{alert("Wrong Password")}},document.getElementById("logout-btn").onclick=w,document.getElementById("add-item-btn").onclick=()=>p(),document.getElementById("modal-cancel").onclick=()=>s.style.display="none",document.getElementById("item-form").onsubmit=async t=>{t.preventDefault();const n={name:document.getElementById("input-name").value,price:document.getElementById("input-price").value,category:document.getElementById("input-category").value,image:document.getElementById("input-image").value};await B(n),s.style.display="none",u()}}function L(e){i.cart[e]=(i.cart[e]||0)+1,f()}function f(){const e=document.getElementById("cart-items");e.innerHTML="";let t=0,n=0;Object.entries(i.cart).forEach(([o,c])=>{const a=i.menu[o];if(a){t+=a.price*c,n+=c;const d=document.createElement("div");d.className="cart-item-row",d.style.display="flex",d.style.justifyContent="space-between",d.style.marginBottom="10px",d.innerHTML=`
            <span>${o} x${c}</span>
            <span>¥${(a.price*c).toFixed(2)}</span>
        `,e.appendChild(d)}}),document.getElementById("drawer-total-price").innerText="¥"+t.toFixed(2),document.getElementById("cart-badge").innerText=n,document.getElementById("checkout-btn").disabled=n===0}h();
