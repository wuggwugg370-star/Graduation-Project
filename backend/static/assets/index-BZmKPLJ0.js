(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(e){if(e.ep)return;e.ep=!0;const c=i(e);fetch(e.href,c)}})();const B="/api";async function u(t,o={}){const n=await(await fetch(`${B}${t}`,o)).json();if(n.code!==200)throw new Error(n.msg||"Error");return n.data||n}const x=()=>u("/menu"),w=t=>u("/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t})}),T=t=>u("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})}),L=t=>u("/admin/item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a={menu:{},cart:{},activeCategory:"All",isAdmin:!1};async function k(){console.log("ğŸš€ ç³»ç»Ÿå¯åŠ¨..."),C(),sessionStorage.getItem("isAdmin")==="true"&&v(),await p()}async function p(){const t=document.getElementById("loading");try{a.menu=await x(),console.log("âœ… èœå•æ•°æ®:",a.menu),b(),f()}catch(o){console.error("âŒ æ•°æ®åŠ è½½å¤±è´¥:",o),t&&(t.innerText="æ— æ³•è¿æ¥æœåŠ¡å™¨ (è¯·æ£€æŸ¥åç«¯)"),Object.keys(a.menu).length===0&&alert(`è¿æ¥åç«¯å¤±è´¥ï¼
è¯·ç¡®è®¤ï¼š
1. é»‘çª—å£æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ
2. æ˜¯å¦çœ‹åˆ°äº† 'Backend running' å­—æ ·ï¼Ÿ`)}finally{t&&(t.style.display="none")}}function b(){const t=new Set(["All"]);Object.values(a.menu).forEach(i=>t.add(i.category||"å…¶ä»–"));const o=document.getElementById("category-bar");o&&(o.innerHTML="",t.forEach(i=>{const n=document.createElement("button");n.className=`cat-btn ${i===a.activeCategory?"active":""}`,n.innerText=i,n.onclick=()=>{a.activeCategory=i,b(),y()},o.appendChild(n)}))}function f(){const t=document.getElementById("menu-grid");if(!t)return;t.innerHTML="";const o=Object.entries(a.menu);if(o.length===0){t.innerHTML='<div style="padding:20px; text-align:center; width:100%;">æš‚æ— èœå“<br>è¯·ç‚¹å‡»å³ä¸Šè§’ Admin æ·»åŠ </div>';return}o.forEach(([i,n])=>{const e=document.createElement("div");e.className="card",e.dataset.name=i,e.dataset.category=n.category||"å…¶ä»–";const c=a.isAdmin?'<button class="edit-btn" style="position:absolute;top:10px;right:10px;z-index:10;background:white;padding:4px 8px;cursor:pointer;border-radius:4px;border:1px solid #ddd;">âœï¸ ç¼–è¾‘</button>':"",s=n.image&&n.image.startsWith("http")?n.image:"https://via.placeholder.com/300x200?text=Delicious";e.innerHTML=`
      <div class="card-img" style="background-image: url('${s}'); position:relative;">${c}</div>
      <div class="card-content">
        <div class="card-tag">${n.category||"æœªåˆ†ç±»"}</div>
        <div class="card-title">${i}</div>
        <div class="card-price">Â¥${Number(n.price).toFixed(2)}</div>
        <button class="btn add-btn">åŠ å…¥è´­ç‰©è½¦</button>
      </div>
    `;const r=e.querySelector(".add-btn");if(r&&(r.onclick=()=>A(i)),a.isAdmin){const d=e.querySelector(".edit-btn");d&&(d.onclick=I=>{I.stopPropagation(),E(i,n)})}t.appendChild(e)}),y()}function y(){const t=document.getElementById("global-search"),o=document.getElementById("menu-grid");if(!o||!t)return;const i=t.value.toLowerCase().trim();Array.from(o.children).forEach(n=>{if(!n.dataset.name)return;const e=n.dataset.name.toLowerCase(),c=n.dataset.category,s=a.activeCategory==="All"||c===a.activeCategory,r=e.includes(i);n.style.display=s&&r?"flex":"none"})}function A(t){a.cart[t]=(a.cart[t]||0)+1,h();const o=document.getElementById("cart-toggle-btn");o&&(o.style.transform="scale(1.2)",setTimeout(()=>o.style.transform="scale(1)",200))}function h(){const t=document.getElementById("cart-items");if(!t)return;t.innerHTML="";let o=0,i=0;Object.entries(a.cart).forEach(([e,c])=>{const s=a.menu[e];if(s){const r=s.price*c;o+=r,i+=c;const d=document.createElement("div");d.className="cart-item",d.style.cssText="display:flex;justify-content:space-between;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid #eee;",d.innerHTML=`
        <span>${e} <small style="color:#666;">x${c}</small></span> 
        <b>Â¥${r.toFixed(2)}</b>
      `,t.appendChild(d)}}),g("drawer-total-price",`Â¥${o.toFixed(2)}`),g("cart-badge",i);const n=document.getElementById("checkout-btn");n&&(n.disabled=i===0,n.style.opacity=i===0?"0.5":"1")}function v(){a.isAdmin=!0,l("admin-toolbar","flex"),l("admin-login-btn","none"),sessionStorage.setItem("isAdmin","true"),f()}function O(){a.isAdmin=!1,l("admin-toolbar","none"),l("admin-login-btn","block"),sessionStorage.removeItem("isAdmin"),f()}function E(t="",o={}){l("item-modal","flex"),m("input-name",t);const i=document.getElementById("input-name");i&&(i.disabled=!!t),m("input-price",o.price||""),m("input-category",o.category||""),m("input-image",o.image||""),g("modal-title",t?"ç¼–è¾‘èœå“":"æ·»åŠ æ–°èœå“")}function C(){const t=(n,e,c)=>{const s=document.getElementById(n);s&&s.addEventListener(e,c)};t("admin-login-btn","click",async()=>{const n=prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç  (admin123):");if(n)try{await T(n),v()}catch{alert("å¯†ç é”™è¯¯")}}),t("logout-btn","click",O),t("search-trigger","click",()=>{const n=document.getElementById("search-overlay");n&&n.classList.add("active"),setTimeout(()=>{var e;return(e=document.getElementById("global-search"))==null?void 0:e.focus()},100)}),t("close-search","click",()=>{const n=document.getElementById("search-overlay");n&&n.classList.remove("active")}),t("global-search","input",y);const o=n=>{const e=document.getElementById("cart-drawer"),c=document.getElementById("drawer-backdrop");n?(e&&e.classList.add("open"),c&&c.classList.add("open")):(e&&e.classList.remove("open"),c&&c.classList.remove("open"))};t("cart-toggle-btn","click",()=>o(!0)),t("close-drawer","click",()=>o(!1)),t("drawer-backdrop","click",()=>o(!1)),t("checkout-btn","click",async()=>{if(Object.keys(a.cart).length===0)return;const n=Object.entries(a.cart).flatMap(([e,c])=>Array(c).fill(e));try{await w(n),a.cart={},h(),o(!1);const e=document.getElementById("success-modal");e&&e.classList.add("show")}catch(e){alert("ä¸‹å•å¤±è´¥: "+e.message)}}),t("success-close-btn","click",()=>{const n=document.getElementById("success-modal");n&&n.classList.remove("show")}),t("add-item-btn","click",()=>E()),t("modal-cancel","click",()=>l("item-modal","none"));const i=document.getElementById("item-form");i&&(i.onsubmit=async n=>{n.preventDefault();const e=i.querySelector('button[type="submit"]'),c=e?e.innerText:"ä¿å­˜";e&&(e.innerText="ä¿å­˜ä¸­...",e.disabled=!0);try{const s={name:document.getElementById("input-name").value,price:document.getElementById("input-price").value,category:document.getElementById("input-category").value,image:document.getElementById("input-image").value};await L(s),alert("ğŸ‰ ä¿å­˜æˆåŠŸï¼"),l("item-modal","none"),await p()}catch(s){alert(`âŒ ä¿å­˜å¤±è´¥ï¼š
`+s.message)}finally{e&&(e.innerText=c,e.disabled=!1)}})}function l(t,o){const i=document.getElementById(t);i&&(i.style.display=o)}function g(t,o){const i=document.getElementById(t);i&&(i.innerText=o)}function m(t,o){const i=document.getElementById(t);i&&(i.value=o)}k();
