!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();async function e(e,t={}){try{const n=await fetch(`/api${e}`,t),o=await n.json();if(200!==o.code)throw new Error(o.msg||"Error");return o.data||o}catch(n){throw n}}const t={menu:{},cart:{},activeCategory:"All",isAdmin:!1};async function n(){const n=document.getElementById("loading");try{t.menu=await e("/menu"),o(),c()}catch(d){n&&(n.innerText="Service Unavailable")}finally{n&&(n.style.display="none")}}function o(){const e=new Set(["All"]);Object.values(t.menu).forEach(t=>e.add(t.category||"其他"));const n=document.getElementById("category-bar");n.innerHTML="",e.forEach(e=>{const c=document.createElement("button");c.className="cat-btn "+(e===t.activeCategory?"active":""),c.innerText=e,c.onclick=()=>{t.activeCategory=e,o(),d()},n.appendChild(c)})}function c(){const e=document.getElementById("menu-grid");e.innerHTML="",Object.entries(t.menu).forEach(([n,o])=>{const c=document.createElement("div");c.className="card",c.dataset.category=o.category||"其他",c.dataset.name=n;const d=t.isAdmin?'<button class="edit-btn" style="position:absolute;top:10px;right:10px;z-index:10;background:white;border:none;border-radius:10px;padding:5px;">✏️ Edit</button>':"";c.innerHTML=`\n      <div class="card-img" style="background-image: url('${o.image||""}'); position:relative;">${d}</div>\n      <div class="card-content">\n        <div class="card-tag">${o.category}</div>\n        <div class="card-title">${n}</div>\n        <div class="card-price">¥${o.price}</div>\n        <button class="btn add-btn">Add</button>\n      </div>\n    `,c.querySelector(".add-btn").onclick=()=>function(e){t.cart[e]=(t.cart[e]||0)+1,s()}(n),t.isAdmin&&(c.querySelector(".edit-btn").onclick=()=>l(n,o)),e.appendChild(c)}),d()}function d(){const e=document.getElementById("menu-grid"),n=document.getElementById("global-search").value.toLowerCase();Array.from(e.children).forEach(e=>{const o=e.dataset.name.toLowerCase(),c=e.dataset.category,d="All"===t.activeCategory||c===t.activeCategory,a=o.includes(n);e.style.display=d&&a?"flex":"none"})}function a(){t.isAdmin=!0,document.getElementById("admin-toolbar").style.display="flex",document.getElementById("admin-login-btn").style.display="none",sessionStorage.setItem("isAdmin","true"),c()}function i(){t.isAdmin=!1,document.getElementById("admin-toolbar").style.display="none",document.getElementById("admin-login-btn").style.display="block",sessionStorage.removeItem("isAdmin"),c()}const r=document.getElementById("item-modal");function l(e="",t={}){r.style.display="flex",document.getElementById("input-name").value=e,document.getElementById("input-name").disabled=!!e,document.getElementById("input-price").value=t.price||"",document.getElementById("input-category").value=t.category||"",document.getElementById("input-image").value=t.image||"",document.getElementById("modal-title").innerText=e?"Edit Item":"Add New Item"}function s(){const e=document.getElementById("cart-items");e.innerHTML="";let n=0,o=0;Object.entries(t.cart).forEach(([c,d])=>{const a=t.menu[c];if(a){n+=a.price*d,o+=d;const t=document.createElement("div");t.innerText=`${c} x${d} = ¥${(a.price*d).toFixed(2)}`,e.appendChild(t)}}),document.getElementById("drawer-total-price").innerText="¥"+n.toFixed(2),document.getElementById("cart-badge").innerText=o,document.getElementById("checkout-btn").disabled=0===o}!async function(){await n(),function(){document.getElementById("search-trigger").onclick=()=>document.getElementById("search-overlay").classList.add("active"),document.getElementById("close-search").onclick=()=>document.getElementById("search-overlay").classList.remove("active"),document.getElementById("global-search").oninput=d;const o=e=>{const t=document.getElementById("cart-drawer").classList,n=document.getElementById("drawer-backdrop").classList;e?(t.add("open"),n.add("open")):(t.remove("open"),n.remove("open"))};document.getElementById("cart-toggle-btn").onclick=()=>o(!0),document.getElementById("close-drawer").onclick=()=>o(!1),document.getElementById("drawer-backdrop").onclick=()=>o(!1),document.getElementById("checkout-btn").onclick=async()=>{const n=Object.entries(t.cart).flatMap(([e,t])=>Array(t).fill(e));await(t=>e("/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:t})}))(n),t.cart={},s(),o(!1),document.getElementById("success-modal").classList.add("show")},document.getElementById("success-close-btn").onclick=()=>document.getElementById("success-modal").classList.remove("show"),document.getElementById("admin-login-btn").onclick=async()=>{const t=prompt("Enter Password:");if(t)try{await(n=t,e("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:n})})),a()}catch(o){alert("Wrong Password")}var n},document.getElementById("logout-btn").onclick=i,document.getElementById("add-item-btn").onclick=()=>l(),document.getElementById("modal-cancel").onclick=()=>r.style.display="none",document.getElementById("item-form").onsubmit=async t=>{t.preventDefault();const o={name:document.getElementById("input-name").value,price:document.getElementById("input-price").value,category:document.getElementById("input-category").value,image:document.getElementById("input-image").value};var c;await(c=o,e("/admin/item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)})),r.style.display="none",n()}}(),"true"===sessionStorage.getItem("isAdmin")&&a()}();
