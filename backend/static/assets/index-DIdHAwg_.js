(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function c(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=c(n);fetch(n.href,i)}})();const B="/api";async function u(e,o={}){const t=await(await fetch(`${B}${e}`,o)).json();if(t.code!==200)throw new Error(t.msg||"Error");return t.data||t}const x=()=>u("/menu"),w=e=>u("/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})}),L=e=>u("/admin/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e})}),T=e=>u("/admin/item",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a={menu:{},cart:{},activeCategory:"All",isAdmin:!1};async function k(){console.log("ğŸš€ ç³»ç»Ÿå¯åŠ¨..."),A(),sessionStorage.getItem("isAdmin")==="true"&&v(),await y()}async function y(){const e=document.getElementById("loading");try{const o=await x();!o||Object.keys(o).length===0?(console.warn("âš ï¸ åç«¯è¿”å›äº†ç©ºèœå•æ•°æ®"),a.menu={}):a.menu=o,console.log("âœ… èœå•æ•°æ®:",a.menu),b(),f()}catch(o){console.error("âŒ æ•°æ®åŠ è½½å¤±è´¥:",o),e&&(e.innerText="æ— æ³•è¿æ¥æœåŠ¡å™¨ (Connection Error)"),alert("è¿æ¥åç«¯å¤±è´¥ï¼Œè¯·ç¡®ä¿é»‘çª—å£æ­£åœ¨è¿è¡Œï¼")}finally{e&&(e.style.display="none")}}function b(){const e=new Set(["All"]);Object.values(a.menu).forEach(c=>{c&&c.category?e.add(c.category):e.add("å…¶ä»–")});const o=document.getElementById("category-bar");o&&(o.innerHTML="",e.forEach(c=>{const t=document.createElement("button");t.className=`cat-btn ${c===a.activeCategory?"active":""}`,t.innerText=c,t.onclick=()=>{a.activeCategory=c,b(),p()},o.appendChild(t)}))}function f(){const e=document.getElementById("menu-grid");if(!e)return;e.innerHTML="";const o=Object.entries(a.menu);if(o.length===0){e.innerHTML=`
      <div style="padding:40px; text-align:center; width:100%; color:#666;">
        <h3>æš‚æ— èœå“æ•°æ®</h3>
        <p>ç³»ç»Ÿæœªæ£€æµ‹åˆ°èœå•æ•°æ®ã€‚</p>
        <p>è¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ ï¼Œæˆ–æ£€æŸ¥åç«¯ menu_data.json æ–‡ä»¶ã€‚</p>
      </div>`;return}o.forEach(([c,t])=>{if(!t)return;const n=document.createElement("div");n.className="card",n.dataset.name=c,n.dataset.category=t.category||"å…¶ä»–";const i=a.isAdmin?'<button class="edit-btn" style="position:absolute;top:10px;right:10px;z-index:10;background:white;padding:4px 8px;cursor:pointer;border-radius:4px;border:1px solid #ddd;">âœï¸ ç¼–è¾‘</button>':"",s=t.image&&t.image.startsWith("http")?t.image:"https://via.placeholder.com/300x200?text=Food";n.innerHTML=`
      <div class="card-img" style="background-image: url('${s}'); position:relative;">${i}</div>
      <div class="card-content">
        <div class="card-tag">${t.category||"æœªåˆ†ç±»"}</div>
        <div class="card-title">${c}</div>
        <div class="card-price">Â¥${Number(t.price||0).toFixed(2)}</div>
        <button class="btn add-btn">åŠ å…¥è´­ç‰©è½¦</button>
      </div>
    `;const r=n.querySelector(".add-btn");if(r&&(r.onclick=()=>C(c)),a.isAdmin){const l=n.querySelector(".edit-btn");l&&(l.onclick=I=>{I.stopPropagation(),E(c,t)})}e.appendChild(n)}),p()}function p(){const e=document.getElementById("global-search"),o=document.getElementById("menu-grid");if(!o||!e)return;const c=e.value.toLowerCase().trim();Array.from(o.children).forEach(t=>{if(!t.dataset.name)return;const n=t.dataset.name.toLowerCase(),i=t.dataset.category,s=a.activeCategory==="All"||i===a.activeCategory,r=n.includes(c);t.style.display=s&&r?"flex":"none"})}function C(e){a.cart[e]=(a.cart[e]||0)+1,h();const o=document.getElementById("cart-toggle-btn");o&&(o.style.transform="scale(1.2)",setTimeout(()=>o.style.transform="scale(1)",200))}function h(){const e=document.getElementById("cart-items");if(!e)return;e.innerHTML="";let o=0,c=0;Object.entries(a.cart).forEach(([n,i])=>{const s=a.menu[n];if(s){const r=s.price*i;o+=r,c+=i;const l=document.createElement("div");l.style.cssText="display:flex;justify-content:space-between;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid #eee;",l.innerHTML=`
        <span>${n} <small style="color:#666;">x${i}</small></span> 
        <b>Â¥${r.toFixed(2)}</b>
      `,e.appendChild(l)}}),g("drawer-total-price",`Â¥${o.toFixed(2)}`),g("cart-badge",c);const t=document.getElementById("checkout-btn");t&&(t.disabled=c===0)}function v(){a.isAdmin=!0,d("admin-toolbar","flex"),d("admin-login-btn","none"),sessionStorage.setItem("isAdmin","true"),f()}function O(){a.isAdmin=!1,d("admin-toolbar","none"),d("admin-login-btn","block"),sessionStorage.removeItem("isAdmin"),f()}function E(e="",o={}){d("item-modal","flex"),m("input-name",e);const c=document.getElementById("input-name");c&&(c.disabled=!!e),m("input-price",o.price||""),m("input-category",o.category||""),m("input-image",o.image||""),g("modal-title",e?"ç¼–è¾‘èœå“":"æ·»åŠ æ–°èœå“")}function A(){const e=(t,n,i)=>{const s=document.getElementById(t);s&&s.addEventListener(n,i)};e("admin-login-btn","click",async()=>{const t=prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç  (admin123):");if(t)try{await L(t),v()}catch{alert("å¯†ç é”™è¯¯")}}),e("logout-btn","click",O),e("search-trigger","click",()=>{const t=document.getElementById("search-overlay");t&&t.classList.add("active")}),e("close-search","click",()=>{const t=document.getElementById("search-overlay");t&&t.classList.remove("active")}),e("global-search","input",p);const o=t=>{const n=document.getElementById("cart-drawer"),i=document.getElementById("drawer-backdrop");t?(n&&n.classList.add("open"),i&&i.classList.add("open")):(n&&n.classList.remove("open"),i&&i.classList.remove("open"))};e("cart-toggle-btn","click",()=>o(!0)),e("close-drawer","click",()=>o(!1)),e("drawer-backdrop","click",()=>o(!1)),e("checkout-btn","click",async()=>{if(Object.keys(a.cart).length===0)return;const t=Object.entries(a.cart).flatMap(([n,i])=>Array(i).fill(n));try{await w(t),a.cart={},h(),o(!1);const n=document.getElementById("success-modal");n&&n.classList.add("show")}catch(n){alert("ä¸‹å•å¤±è´¥: "+n.message)}}),e("success-close-btn","click",()=>{const t=document.getElementById("success-modal");t&&t.classList.remove("show")}),e("add-item-btn","click",()=>E()),e("modal-cancel","click",()=>d("item-modal","none"));const c=document.getElementById("item-form");c&&(c.onsubmit=async t=>{t.preventDefault();const n=c.querySelector('button[type="submit"]');n&&(n.innerText="ä¿å­˜ä¸­...");try{const i={name:document.getElementById("input-name").value,price:document.getElementById("input-price").value,category:document.getElementById("input-category").value,image:document.getElementById("input-image").value};await T(i),alert("ğŸ‰ ä¿å­˜æˆåŠŸï¼"),d("item-modal","none"),await y()}catch(i){alert(`âŒ ä¿å­˜å¤±è´¥ï¼š
`+i.message)}finally{n&&(n.innerText="ä¿å­˜")}})}function d(e,o){const c=document.getElementById(e);c&&(c.style.display=o)}function g(e,o){const c=document.getElementById(e);c&&(c.innerText=o)}function m(e,o){const c=document.getElementById(e);c&&(c.value=o)}k();
